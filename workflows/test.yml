description: MeroSign Application Test Workflow
name: MeroSign App Test

auth_service: true

nodes:
  chain_id: testnet-1
  count: 2
  image: ghcr.io/calimero-network/merod:edge
  prefix: merosign-node

steps:
  # Step 1: Install the MeroSign application
  - name: Install MeroSign Application
    type: install_application
    node: merosign-node-1
    path: "logic/res/mero_sign.wasm"
    dev: true
    outputs:
      app_id: applicationId

  # Step 2: Install the MeroSign application on node 2
  - name: Install MeroSign Application on node 2
    type: install_application
    node: merosign-node-2
    path: "logic/res/mero_sign.wasm"
    dev: true
    outputs:
      app_id_2: applicationId

  # Step 3: Create a default private context for the MeroSign app
  - name: Create Default Private Context on node 1
    type: create_context
    node: merosign-node-1
    application_id: "{{app_id}}"
    params: '{"is_private": true, "context_name": "default"}'
    outputs:
      context_id_1: contextId
      member_public_key_1: memberPublicKey

  - name: Create Default Private Context on node 2
    type: create_context
    node: merosign-node-2
    application_id: "{{app_id_2}}"
    params: '{"is_private": true, "context_name": "default"}'
    outputs:
      context_id_2: contextId
      member_public_key_2: memberPublicKey

  # Step 4: Wait for context creation and sync
  - name: Wait For Context Sync
    type: wait
    seconds: 1

stop_all_nodes: false
force_pull_image: true
restart: true
wait_timeout: 60
